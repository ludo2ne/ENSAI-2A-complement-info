<!doctype html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
        <title>Complements d'informatique CM2</title>
        <link rel="icon" href="../img/ensai_logo_transparent.png" type="image/x-icon">
    
    
        <link rel="stylesheet" href="../../css/reveal.css">
        <link rel="stylesheet" href="../../css/theme/solarized.css">
        <link rel="stylesheet" href="../../css/mine.css">
        <link rel="stylesheet" href="../../css/simple-grid.css">
    
    
        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="../../css/zenburn.css">
    
        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? '../../css/print/pdf.css' : '../../css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
    
    
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? '../../css/print/mine-pdf.css' : '../../css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
    
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match(/print-pdf/gi) ? '../../css/theme/white.css' : '../../css/print/paper.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        </script>
    </head>
    
    

<body>
    <div class="reveal">
        <div class="slides">

            <section>
                <section>
                    <h1>Compl√©ments d'info,  CM2</h1>
                    <h3>Les webservices</h3>
                    <p>DENEUVILLE Ludovic (sur la base des cours de R√©mi P√©pin)</p>
                    <p>ludovic.deneuville@ensai.fr</p>
                </section>
            </section>  

                <section>
                    <h3>Le plan</h3>
                    <ol style="font-size: xx-large;">
                        <li>Rappels</li>                        
                        <li>API</li>
                        <li>
                            Webservice
                            <ol>
                                <li>D√©finition</li>
                                <li>Exemples</li>
                                <li>Architecture microservices</li>
                            </ol>
                        </li>
                        <li>
                            Hyper Text Transfer Protocol
                            <ol>
                                <li>D√©finition</li>
                                <li>Exemples</li>
                            </ol>
                        </li>
                    </ol>
                </section>

            </section>
			

            <section>
                <section>
                    <h2>
                        Rappel de la semaine derni√®re
                    </h2>
                    <iframe src="https://giphy.com/embed/Jap1tdjahS0rm" width="900" height="500" frameBorder="0" class="no-print giphy-embed"
                        allowFullScreen></iframe>
                </section>

                <section data-background="#000000">
                    <p class="starWars"> Il y a pas longtemps, dans une galaxie pas vraiment lointaine ...</p>
                </section>

                <section data-background="#000000">
                    <img class="plain" src="img/logo_SW_separation_of_concern.png" alt="">
                </section>

                <section>
                    <h3>Plus s√©rieusement</h3>

                    <img src="img/3 couches.png" alt="" class="w80">
                </section>

                <section>
                    <h3>S√©paration en couche</h3>
                    <ul>
                        <li class="fragment">Chaque couche s'occupe d'une macro t√¢che</li>
                        <li class="fragment">Une couche communique seulement avec les couches adjacentes</li>
                    </ul>
                </section>

                <section>
                    <h3>L'√©tape d'apr√®s</h3>
                    D√©composer une couche en modules
                </section>

                <section>
                    <h3>Exemples</h3>
                    <p>Site de e-commerce</p>
                    <ul>
                        <li>Module authentification</li>
                        <li>Module gestion de compte</li>
                        <li>Module paiement</li>
                        <li>Module de recherche</li>
                        <li>Module analyse des donn√©es</li>
                        <li>Module panier</li>
                    </ul>
                </section>

            </section>
            <section>

                <section>
                    <h2>Application Programming Interface (API)</h2>
					
					<aside class="notes">
						Sert pour communiquer entre les couches
					</aside>
                </section>

                <section>
                    <h3>API d√©finition</h3>
                    <div class="important-bloc">
                        Interface entre deux ordinateurs ou deux programmes. C'est une application
                        qui offre des services √† d'autres applications. On dit que l'application
                        <b>impl√©mente</b> une API ou <b>expose</b> une API
                    </div>
					
                </section>

                <section>
                    <h3>API d√©finition</h3>
                    <p>Termes assez vaste qui recouvre :</p>
                    <ul>
                        <li>Les biblioth√®ques / framework :
                             <a href="https://pandas.pydata.org/docs/reference/index.html">Pandas</a>,
                             <a href="https://scikit-learn.org/stable/modules/classes.html">Scikit learn</a></li>
                        <li>Des webservices</li>
                        <li>Un moyen d'acc√©der aux ressources d'un hardware : 
                            <a href="https://developer.nvidia.com/nvapi">Nvidia API</a></li>
                    </ul>
					
					<aside class="notes">
						scikit-learn is a Python module for machine learning
					</aside>				

                </section>

                <section>
                    <h3>API in a nutshell</h3>
                    <ul>
                        <li class="fragment">Expose des m√©thodes/fonctions aux utilisateurs</li>
                        <li class="fragment">R√©utilisation</li>
                        <li class="fragment">Contractualisation des inputs/outputs</li>
                        <li class="fragment">Bo√Æte noire</li>
                    </ul>
                    <aside class="notes">Pour reprendre l'exemple du dessus, le module d'authentification peut √™tre utilis√©
                        aussi bien par les utilisateur pour la version site marchand, que les admins pour pour la partie
                        administration.
                    </aside>
                </section>

                <section>
                    <div class="important-bloc">Une API rend un service aux utilisateurs sans qu'ils aient √† savoir comment
                        elle fait. Ils connaissent juste ce qu'elle attend en entr√©e et ce qu'elle produit !
                    </div>
                </section>

            </section>



            <section>

                <section>
                    <h2>Une API particuli√®re, les webservices</h2>
                    <a href="https://www.testarchitect.com/product/features-and-supported-platforms/testarchitect-supported-platforms/web-service-and-api-testing">
                        <img src="img/web-service.png" alt="web service">
                    </a>
                </section>

                <section>
                    <h3>It's question time !! YEAAAAHHHH</h3>
                    √Ä votre avis, Twitter permet-il √† tout le monde d'acc√©der √† leurs bases de donn√©es directement ?
                    <aside class="notes">Bien s√ªr non !</aside>
                </section>

                <section>
                    <h3>Wait what ?!</h3>
                    <p>
                        Pourtant tout le monde utilise les donn√©es twitter !

                    </p>

                    <p class="fragment">Comment font-ils ?</p>
                </section>

                <section class="no-print">
                    <h3>Des id√©es ?</h3>

                    <iframe src="https://giphy.com/embed/8acGIeFnqLA7S" width="600" height="600" frameBorder="0" class="no-print giphy-embed" allowFullScreen></iframe>
                </section>

                <section>
                    <h3>Solution : web scraper</h3>
                    Consiste √† √©crire une application qui se connecte √† un site, et qui va lire la page pour en tirer des informations
                    <div class="fragment">
                        <p class="important">Probl√®mes</p>
                        <ul>
                            <li>Cr√©e du trafic artificiel (c√¥t√© site)</li>
                            <li>Chaque changement dans le site casse notre application</li>
                            <li>G√©rer le javascript üò±üò±üò±üò±</li>
                        </ul>
                    </div>

                    <aside class="notes">
					    Dire que derri√®re un site il y a du HTML. <br>
						Montrer un exemple ?
					</aside>
                </section>

                <section>
                    <h3>Autre solution : cr√©er un point d'entr√©e pour les machines </h3>
                    <ul>
                        <li class="fragment">Accessible depuis le web</li>
                        <li class="fragment">Fait pour les machines</li>
                        <li class="fragment important">Contr√¥le ce que l'on rend accessible</li>
                    </ul>

                    <div class="important-bloc fragment">Interface entre l'ext√©rieur et notre syst√®me</div>
                </section>

                <section>
                    <h3>D√©mo</h3>
					
					<aside class="notes">
						Exemple : https://api.gouv.fr/documentation/api_data_gouv <br>
						https://anapioficeandfire.com/
					</aside>
                </section>

                <section>
                    <h3>Les webservices</h3>
                    <ul>
                        <li class="fragment">Application web</li>
                        <li class="fragment important">Accessible via requ√™te HTTP/HTTPS</li>
                        <li class="fragment">Sans interface graphique</li>
                        <li class="fragment important">Renvoie des donn√©es compr√©hensibles par les machines (JSON, XML...)</li>
                    </ul>			
					
					<aside class="notes">
						Webservice : une api particuli√®re que nous allons utiliser
					</aside>
					
                </section>

                <section>
                    <h3>Plusieurs types</h3>
                    <ul>
                        <li>REST : le plus courant, le type que vous allez manipuler, json</li>
                        <li>SOAP : plus complet donc plus lourd que le REST, xml</li>
                        <li>RPC : Remote Procedure Call</li>
                    </ul>
					
					<aside class="notes">
						REST est un style architectural qui d√©finit un ensemble de contraintes et de principes					
					</aside>					
                </section>

                <section>
                    <div class="important-bloc">Un web service est un module applicatif, accessible sur le protocole HTTP
                        via une URL qui va r√©pondre √† une demande
                    </div>

                    <p class="important fragment">Comme un site web, mais pour les machines ü§ñ</p>
                </section>


                <section>
                    <h3>Exemple</h3>
                    <a href="https://data.rennesmetropole.fr/api/records/1.0/search/?dataset=etat-du-trafic-en-temps-reel">
                        Le trafic √† Rennes en temps r√©el</a>
						
					<aside class="notes">
						https://data.rennesmetropole.fr/explore/dataset/export-api-parking-citedia/api/
					</aside>				
					
                </section>

                <section>
                    <h3>Architecture microservices </h3>
                    <p>Site de e-commerce</p>
                    <ul>
                        <li>WS authentification</li>
                        <li>WS gestion de compte</li>
                        <li>WS paiement</li>
                        <li>WS de recherche</li>
                        <li>WS analyse des donn√©es</li>
                        <li>WS gestion panier</li>
                    </ul>
                </section>

                <section>
                    <h3>Architecture microservices </h3>
                    Chaque module est un webservice ind√©pendant, et c'est l'application c√¥t√© client qui va les contacter

                    <div class="fragment important">
                        Utile pour les grandes entreprises avec beaucoup de dev et de projets
                        en parall√®le
                    </div>
                    <aside class="notes">Un dessin pourrait peut-√™tre aider</aside>
                </section>

                <section>
                    <h3>Comment √ßa fonctionne ?</h3>
                    <iframe src="https://giphy.com/embed/a5viI92PAF89q"  width="900" height="500" frameBorder="0" class="no-print giphy-embed" allowFullScreen></iframe>

                </section>

                <section>
                    <h3>La notion de client-serveur</h3>
                    <ul>
                        <li class="fragment"><span class="important">LE MOD√àLE QUI R√âGIT LE WEB</span></li>
                        <li class="fragment">Des machines qui attendent des demandes : <span class="important">serveurs</span></li>
                        <li class="fragment">Des machines qui font des demandes : <span class="important">clients</span></li>
                        <li class="fragment">Le client initie le contact, le serveur r√©pond</li>
                    </ul>
                </section>

                <section class="no-print">
                    <h3>Comparaison avec vie r√©elle</h3>
                    <ul>
                        <li class="fragment">Vous marchez dans la rue et vous avez envie d'un caf√© frapp√© Double shot espresso
                            and Cream</li>
                        <li class="fragment">Vous rentrez dans un Starbucks et <span class="important">demandez</span> votre
                            caf√© </li>
                        <li class="fragment">Le <span class="important">serveur</span> traite votre demande et vous donne
                            votre caf√©</li>
                        <li class="fragment">Vous partez avec votre caf√©</li>
                    </ul>

                    <aside class="notes"></aside>
                </section>

                <section>
                    <h3>Communication client-serveur</h3>
                </section>

                <section>
                    <h3>Mon pc conna√Æt-il www.google.com ?</h3>

                    <img class="w60 plain" src="https://66.media.tumblr.com/tumblr_m7ois2qIWv1r4q04g.gif" alt="">

                </section>


                <section>
                    <h3>NON !</h3>


                </section>

                <section>
                    Votre machine sait manipuler des <span class="important"> adresse IP</span>, pas des <span class="important">noms
                        de domaine</span>
                </section>

                <section>
                    <h3>Comparaison avec vie r√©elle</h3>
                    <p class="fragment">Vous rentrez dans un taxi et demandez d'aller
                        chez Ludovic Deneuville
                    </p>
                    <p class="fragment">Deux options :</p>
                    <ul>
                        <li class="fragment">Il vous amm√®ne chez moi directement ü§®</li>
                        <li class="fragment">Il vous demande mon adresse üòÄ</li>
                    </ul>
                </section>


                <section>
                    <h3>Nom de domaine, IP, DNS, port</h3>
                    <ul>
                        <li>Nom de domaine : nom "human friendly"</li>
                        <li>Adresse IP : adresse de la machine sur internet</li>
                        <li>DNS : serveurs qui font la lien entre nom de domaine et IP</li>
                        <li>Port : canal de communication, identifie le type de communication</li>
                    </ul>
                    <aside class="notes">Les DNS sont eux les garants du web tel qu'on le connait. Effacer un nom de domaine
                        d'un DNS veut dire supprimer le serveur d'internet sauf pour ceux qui ont son IP. En interne, potentiellement
                        pas de dns, donc besoin de se souvenir des IP.
                    </aside>
                </section>

                <section>
                    <h3>Pour r√©sumer</h3>
                    <ul>
                        <li class="fragment">Client : initie une communication</li>
                        <li class="fragment">Serveur : r√©pond aux clients</li>
                        <li class="fragment">Ne connaissent que les adresses IP</li>
                        <li class="fragment"> DNS : nom de domaine -> IP</li>
                        <li class="fragment">Plusieurs ports chacun avec un type de communication associ√©e par d√©faut.
                        </li>
                        <li class="fragment important">Communique via HTTP</li>
                    </ul>
                </section>
                <section class="no-print">
                    <h3>Des questions ?</h3>
                    </section>

            </section>


            <section>
                <section>
                    <h2>Hyper Text Transfer Protocol (HTTP)</h2>
                </section>
                <section>
                    <h3>HTTP</h3>
                    <p>Protocole de communication client-serveur d√©velopp√© pour le World Wide Web</p>
                    <p>N'est pas le seul FTP, SMTP, IRC ...</p>
                    <p>Il existe des protocoles non client-serveur : BitTorrent </p>
                </section>
                <section class="no-print">
                    <h3>Avez vous une id√©e de requ√™te HTTP ?</h3>

                    <iframe src="https://giphy.com/embed/a5viI92PAF89q"  width="900" height="500" frameBorder="0" class="no-print giphy-embed" allowFullScreen></iframe>
                    <aside class="notes">Vous faites tout le temps des requ√™tes HTTP sans le savoir.</aside>
                </section>

                <section>
                    <h3>Avez vous une id√©e de requ√™te HTTP ?</h3>

                    <p>Demander une page web via votre navigateur cr√©e une requ√™te HTTP</p>
                    <aside class="notes">Vous faites tout le temps des requ√™tes HTTP sans le savoir.</aside>
                </section>


                <section>
                    <h3>Les √©l√©ments d'une requ√™te</h3>
                    <ul>
                        <li>La localisation de la ressource : URL (nom de domaine + chemin)</li>
                        <li>La m√©thode employ√©e (GET, POST, UPDATE, DELETE ...)</li>
                        <li>Les param√®tres de la requ√™te</li>
                        <li>Le corps de la requ√™te</li>
                    </ul>
                    <aside class="notes">
                        Les param√®tres sont derri√®re le ? <br>
						le corps vous ne le voyez pas, mais possible de le voir
                    </aside>
                </section>

                <section>
                    <h3>Les √©l√©ments d'une requ√™te</h3>
                    <span class="fragment highlight-blue">GET </span>
                    <span class="fragment highlight-red">https://pokeapi.co/api/v2/pokemon</span><span class="fragment highlight-important">?limit=10&offset=200</span>
                    <p class="fragment">Pas de corps</p>
                </section>

                <section>
                    <h3>D√©mo</h3>
                </section>

                <section>
                    <h3>Les m√©thodes HTTP</h3>
                    <ul>
                        <li>POST</li>
                        <li>GET</li>
                        <li>UPDATE</li>
                        <li>DELETE</li>
                    </ul>
                    <div class="fragment important-bloc ">C'est le CRUD !</div>
					
					<aside class="notes">
						Comme en SQL
					</aside>
                </section>


                <section>
                    <h3>Exemple</h3>
                    <p>http://web-services.domensai.ecole/attack</p>
                    <ul>
                        <li>GET : r√©cup√©rer toutes les attaques</li>
                        <li>POST : ajouter une attaque</li>
                        <li>UPDATE : modifier une attaque en ajoutant son id en param√®tre</li>
                        <li>DELETE : supprimer une attaque en ajoutant son id en param√®tre</li>
                    </ul>
                </section>

                <section>
                    <h3>Pour r√©sumer</h3>
                    <ul>
                        <li class="fragment">Le HTTP est le protocole du web</li>
                        <li class="fragment">M√©thode</li>
                        <li class="fragment">URL</li>
                        <li class="fragment">Param√®tres dans URL ou corps</li>
                    </ul>
                </section>

            </section>

                <section>

                    <section>
                        <h2>
                            Contacter/r√©aliser un webservice
                        </h2>
                    </section>

                    <section>
                        <h3>Contacter un webservice</h3>
                        <p>Un outil : un client HTTP</p>
                        <ul>
                            <li>Un navigateur web (assez limit√©)</li>
                            <li>Insomnia/Postman</li>
                            <li>Vscode avec des plugins</li>
                            <li>Python avec le plugin <code>requests</code></li>
                        </ul>
                    </section>
                    <section>
                        <h3>Contacter un webservice en python</h3>
                        <pre><code data-trim data-noescape>
import requests

# Construction de la requ√™te
url = "https://data.rennesmetropole.fr/api/records/1.0/search/"
parametres = {"dataset": "etat-du-trafic-en-temps-reel", "rows": 2}

# Lancement de la requ√™te
res = requests.get(url=url, params=parametres)

# Affichage du r√©sultat
print(res.json())

print("\nNombre de lignes : ", res.json()["parameters"]["rows"])
                        </code></pre>
                    </section>

                    <section>
                        <h3>Contacter un webservice en python</h3>
                        <pre><code data-trim data-noescape class="language-python">
import json
import requests

url = "https://anapioficeandfire.com/api/"
end_point = "characters"
parametres = {"gender": "Female", "isAlive": True, "culture": "Braavosi"}
response = requests.get(url=url + end_point, params=parametres)

# Teste si le serveur a r√©pondu
if response.status_code != 200:
    raise Exception(
        "Cannot reach (HTTP {}): {}".format(response.status_code, response.text)
    )
print(json.dumps(response.json()))

                        </code></pre>
                    </section>

                    <section>
                        <h3>Contacter un webservice en python</h3>
                        <pre><code data-trim data-noescape>
def delete_all_rules(rules):
    if rules is None or "data" not in rules:
        return None

    ids = list(map(lambda rule: rule["id"], rules["data"]))
    payload = {"delete": {"ids": ids}}
    response = requests.post(
        "https://api.twitter.com/2/tweets/search/stream/rules",
        headers=bearer_oauth(),
        json=payload
    )
    if response.status_code != 200:
        raise Exception(
            "Cannot delete rules (HTTP {}): {}".format(
                response.status_code, response.text
            )
        )
    print(json.dumps(response.json()))
                        </code></pre>
                    </section>

                    <section>
                        <h3>Contacter un webservice en python</h3>
                        <ul>
                            <li>Tr√®s facile</li>
                            <li><code>res.json()</code> retourne un dictionnaire</li>
                            <li><code>get()</code> peux devenir <code>post()</code>, <code>put()</code>, etc.  </li>
                        </ul>

                    </section>

                    <section>
                        <h3>R√©aliser un webservice en python</h3>
                        <ul>
                            <li class="fragment">Peut sembler complexe üòµ</li>
                            <li class="fragment">Mais il existe des outils pour nous aider üòé</li>
                            <li class="fragment">Pas besoin d'√™tre un expert de l'informatique ! üê±‚Äçüíª</li>
                        </ul>

                    </section>

                    <section>
                        <h3>3 frameworks</h3>
                        <ul>
                            <li><a href="https://fastapi.tiangolo.com/">FlaskRESTful</a> : mature, leger, flexible</li>
                            <li><a href="https://www.djangoproject.com/">Django</a> : mature, robuste, compl√®te</li>
                            <li class="fragment highlight-important""><a href="https://fastapi.tiangolo.com/">FastApi</a> : jeune, leger, moderne</li>
                        </ul>
						
						<aside class="notes">
							FastApi pour le TP2
						</aside>
						
                    </section>
					
                    <section>
                        <h3>FastApi : les bases </h3>
                        <pre><code data-trim data-noescape>
from fastapi import FastAPI

app = FastAPI()
@app.get("/")
async def root():
    return {"message": "Hello World"}


if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8000)
                        </code></pre>

                    </section>
                    <section>
                        <h3>FastApi</h3>
                        <ul>
                            <li>Il est facile de coder vos endpoints</li>
                            <li>La <a href="https://fastapi.tiangolo.com/tutorial/first-steps/">documentation</a> est extr√™mement bien faite</li>
                            <li>Vous vous concentrez sur l'essentiel</li>
                        </ul>
                    </section>

                </section>
            <section class="no-print">
                <h2>THE END</h2>
                <iframe src="https://giphy.com/embed/fnlXXGImVWB0RYWWQj" width="480" height="480" frameBorder="0" class="no-print giphy-embed" allowFullScreen></iframe>
            </section>


        </div>
    </div>

    <script src="../../dist/reveal.js"></script>
    <script src="../../plugin/zoom/zoom.js"></script>
    <script src="../../plugin/notes/notes.js"></script>
    <script src="../../plugin/search/search.js"></script>
    <script src="../../plugin/markdown/markdown.js"></script>
    <script src="../../plugin/highlight/highlight.js"></script>
    <script src="../../plugin/math/math.js"></script>
    <script>

        // Also available as an ES module, see:
        // https://revealjs.com/initialization/
        Reveal.initialize({
            controls: true,
            progress: true,
            center: true,
            hash: true,
            viewDistance: 3,
            width: 1080,
            height: 720,
            slideNumber: 'c/t',
            pdfSeparateFragments: false ,
            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight]
        });

    </script>

</body>

</html>